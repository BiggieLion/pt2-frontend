<app-nav-bar></app-nav-bar>

<div class="solicitud-details" *ngIf="solicitud" style="padding: 24px">
  <h2>{{ solicitud.title }}</h2>

  <section>
    <h3>Información general</h3>
    <p><strong>ID:</strong> {{ solicitud.id }}</p>
    <p><strong>Estatus:</strong> {{ solicitud.status }}</p>
    <p><strong>Tipo de crédito:</strong> {{ solicitud.creditType }}</p>
    <p><strong>Monto solicitado:</strong> ${{ solicitud.amount }}</p>
    <p><strong>Plazo (Meses):</strong> {{ solicitud.loan_term }} meses</p>
  </section>

  <section>
    <h3>Documentos</h3>
    <div style="display: flex; gap: 24px">
      <div
        *ngIf="solicitud?.url_domicile"
        style="display: flex; flex-direction: column; align-items: center"
      >
        <img
          src="assets/pdf.png"
          alt="PDF"
          width="40"
          height="40"
          style="cursor: pointer"
          (click)="openInNewTab(solicitud.url_domicile)"
        />
        <span>Domicilio</span>
      </div>

      <div
        *ngIf="solicitud?.url_birth"
        style="display: flex; flex-direction: column; align-items: center"
      >
        <img
          src="assets/pdf.png"
          alt="PDF"
          width="40"
          height="40"
          style="cursor: pointer"
          (click)="openInNewTab(solicitud.url_birth)"
        />
        <span>Acta</span>
      </div>

      <div
        *ngIf="solicitud?.url_ine"
        style="display: flex; flex-direction: column; align-items: center"
      >
        <img
          src="assets/pdf.png"
          alt="PDF"
          width="40"
          height="40"
          style="cursor: pointer"
          (click)="openInNewTab(solicitud.url_ine)"
        />
        <span>INE</span>
      </div>

      <div
        *ngIf="solicitud?.url_guarantee"
        style="display: flex; flex-direction: column; align-items: center"
      >
        <img
          src="assets/pdf.png"
          alt="PDF"
          width="40"
          height="40"
          style="cursor: pointer"
          (click)="openInNewTab(solicitud.url_guarantee)"
        />
        <span>Garantía</span>
      </div>
    </div>
  </section>

  <section>
    <h3>Información laboral</h3>
    <p><strong>Ocupación:</strong> {{ solicitud.occupationType }}</p>
    <p><strong>Escolaridad:</strong> {{ solicitud.education_level }}</p>
    <p><strong>Ingreso mensual:</strong> ${{ solicitud.monthly_income }}</p>
  </section>

  <section>
    <h3>Relación de esfuerzo</h3>
    <p>
      <strong>Mensualidad estimada:</strong> ${{
        solicitud.amount / solicitud.loan_term | number : "1.2-2"
      }}
    </p>
    <p [ngStyle]="{ color: esfuerzoAlto ? '#b98c00' : 'inherit' }">
      <strong>Relación de esfuerzo:</strong> {{ esfuerzo }}%
      <span *ngIf="esfuerzoAlto"> ⚠️</span>
    </p>
    <p
      *ngIf="esfuerzoAlto"
      style="color: #b98c00; font-size: 0.85rem; margin-top: -8px"
    >
      Relación de esfuerzo alta
    </p>
  </section>

  <section>
    <h3>Información familiar y patrimonial</h3>
    <p><strong>Hijos:</strong> {{ solicitud.count_children }}</p>
    <p>
      <strong>Miembros de la familia:</strong>
      {{ solicitud.count_family_members }}
    </p>
    <p><strong>Tipo de vivienda:</strong> {{ solicitud.hasDomicile }}</p>
    <p>
      <strong>Vivienda propia:</strong>
      {{ solicitud.has_own_realty ? "Sí" : "No" }}
    </p>
    <p>
      <strong>Garantía:</strong> {{ solicitud.has_guarantee ? "Sí" : "No" }}
    </p>
    <p>
      <strong>Valor de la garantía:</strong>
      {{ solicitud.guarantee_value != null ? solicitud.guarantee_value : 0 }}
    </p>
  </section>

  <button
    (click)="procesarIA()"
    style="
      margin-top: 16px;
      padding: 10px 20px;
      background-color: #333;
      color: white;
      border: none;
      border-radius: 8px;
    "
  >
    Procesar con IA
  </button>

  <div
    *ngIf="iaResultado !== null"
    style="
      margin-top: 30px;
      text-align: center;
      border: 2px solid #ccc;
      border-radius: 12px;
      padding: 20px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
      background-color: white;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    "
  >
    <p style="font-size: 20px; margin-bottom: 10px">
      <strong>Resultado IA: </strong>
      <span [style.color]="iaColor">{{ iaResultado }}%</span>
    </p>
    <p [style.color]="iaColor" style="font-weight: bold; font-size: 18px">
      {{ iaMensaje }}
    </p>
  </div>
</div>

<div *ngIf="!solicitud" style="padding: 24px">
  <p>No se recibió ninguna solicitud.</p>
</div>
<div
  *ngIf="iaResultado !== null && iaResultado > 40"
  style="
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
    margin-bottom: 20px;
  "
>
  <button
    *ngIf="iaResultado <= 60"
    (click)="rechazarSolicitud()"
    style="
      padding: 10px 20px;
      border: 2px solid #cc0000;
      background: transparent;
      color: #cc0000;
      border-radius: 8px;
    "
  >
    Rechazar solicitud
  </button>

  <button
    (click)="aprobarSolicitud()"
    style="
      padding: 10px 20px;
      border: 2px solid #2a8f2a;
      background: transparent;
      color: #2a8f2a;
      border-radius: 8px;
    "
  >
    Aprobar solicitud
  </button>
</div>

<div style="height: 20px"></div>
